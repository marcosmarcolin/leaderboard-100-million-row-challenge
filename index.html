<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>PHP 100M Row Challenge Explorer | by Marcos Marcolin</title>
    <meta name="title" content="PHP 100M Row Challenge Explorer | by Marcos Marcolin">
    <meta name="description"
          content="An interactive leaderboard for the Tempest 100 Million Row Challenge. Created by Marcos Marcolin to showcase modern PHP performance.">
    <meta name="author" content="Marcos Marcolin">

    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JCT8KFTVZ5"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-JCT8KFTVZ5');
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap"
          rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            scroll-behavior: smooth;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-text {
            background: linear-gradient(to right, #60a5fa, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .row-animate {
            animation: fadeInUp 0.4s ease forwards;
            opacity: 0;
        }

        select option {
            background-color: #1e293b;
        }
    </style>
</head>
<body class="text-slate-200 antialiased min-h-screen flex flex-col">

<div class="max-w-6xl mx-auto px-4 py-10 flex-grow w-full">
    <header class="mb-10 flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-slate-800 pb-8 text-center md:text-left">
        <div>
            <h1 class="text-4xl font-extrabold tracking-tight text-white mb-2">
                <a href="index.html" class="hover:opacity-80 transition-opacity">
                    <span class="gradient-text">PHP</span> High Performance <span
                        class="text-slate-500 text-3xl">100M</span>
                </a>
            </h1>
            <p class="text-slate-400 italic font-medium">Crunching 100 Million Rows with Modern PHP</p>
            <a href="https://github.com/tempestphp/100-million-row-challenge" target="_blank"
               class="inline-flex text-xs text-blue-400 hover:text-blue-300 transition-colors items-center mt-2 group">
                <svg class="w-4 h-4 mr-1 group-hover:scale-110 transition-transform" fill="currentColor"
                     viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Official Challenge Repository
            </a>
        </div>

        <div class="flex flex-col gap-2">
            <label class="text-xs font-bold uppercase tracking-wider text-slate-500">Execution Strategy</label>
            <select id="repoSelector"
                    class="bg-slate-800 border border-slate-700 text-white rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer">
                <option value="all">All Strategies</option>
                <option value="main">Parallel / Multi-process</option>
                <option value="single-thread">Single-process (Core)</option>
            </select>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="glass p-4 rounded-2xl flex flex-col items-center justify-center border-blue-500/20">
            <span class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Fastest Time</span>
            <span id="stat-fastest" class="text-xl font-bold text-green-400 mono">--</span>
        </div>
        <div class="glass p-4 rounded-2xl flex flex-col items-center justify-center border-purple-500/20">
            <span class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Avg Performance</span>
            <span id="stat-avg" class="text-xl font-bold text-purple-400 mono">--</span>
        </div>
        <div class="glass p-4 rounded-2xl flex flex-col items-center justify-center border-slate-700">
            <span class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Entries</span>
            <span id="stat-total" class="text-xl font-bold text-white mono">--</span>
        </div>
        <div class="glass p-4 rounded-2xl flex flex-col items-center justify-center border-slate-700">
            <span class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Target</span>
            <span class="text-xl font-bold text-slate-400 mono">100M ROWS</span>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-8">
        <div class="md:col-span-4">
            <input type="text" id="searchInput" placeholder="Search user..."
                   class="w-full bg-slate-800/50 border border-slate-700 px-5 py-4 rounded-2xl text-white outline-none glass focus:ring-2 focus:ring-blue-500 transition-all">
        </div>
        <div class="md:col-span-3">
            <select id="timeFilter"
                    class="w-full h-full bg-slate-800/50 border border-slate-700 px-4 py-4 rounded-2xl text-white outline-none glass cursor-pointer">
                <option value="all">All Execution Times</option>
                <option value="5">Under 5s</option>
                <option value="10">Under 10s</option>
                <option value="30">Under 30s</option>
            </select>
        </div>
        <div class="md:col-span-3">
            <select id="sortFilter"
                    class="w-full h-full bg-slate-800/50 border border-slate-700 px-4 py-4 rounded-2xl text-white outline-none glass cursor-pointer">
                <option value="fastest">Fastest Performance</option>
                <option value="recent">Recent Submissions</option>
            </select>
        </div>
        <div class="md:col-span-2">
            <button id="resetFilters"
                    class="w-full h-full bg-red-500/10 border border-red-500/20 hover:bg-red-500/20 text-red-400 font-bold py-4 rounded-2xl transition-all glass flex items-center justify-center gap-2 group">
                <svg class="w-4 h-4 group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor"
                     viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                RESET
            </button>
        </div>
    </div>

    <div class="glass rounded-3xl overflow-hidden shadow-2xl border border-slate-800">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                <tr class="bg-slate-800/80 text-slate-400 text-xs uppercase tracking-widest border-b border-slate-700">
                    <th class="px-8 py-5">Rank</th>
                    <th class="px-8 py-5">User / Branch</th>
                    <th class="px-8 py-5 text-right">Execution Time</th>
                    <th class="px-8 py-5 text-center">Date</th>
                </tr>
                </thead>
                <tbody id="tableBody" class="divide-y divide-slate-800/50"></tbody>
            </table>
        </div>
    </div>
</div>

<footer class="mt-auto py-8 text-center border-t border-slate-800 bg-slate-900/50">
    <p class="text-slate-500 text-sm">Maintained by <a href="https://github.com/marcosmarcolin" target="_blank"
                                                       class="text-blue-400 hover:underline transition-colors">marcosmarcolin</a>
    </p>
</footer>

<script>
    const URLS = {
        'main': 'https://raw.githubusercontent.com/tempestphp/100-million-row-challenge/refs/heads/main/leaderboard.csv',
        'single-thread': 'https://raw.githubusercontent.com/tempestphp/100-million-row-challenge/refs/heads/main/leaderboard-single-thread.csv'
    };

    const MEDALS = {1: 'ðŸ¥‡', 2: 'ðŸ¥ˆ', 3: 'ðŸ¥‰'};

    let rawData = [];
    const searchInput = document.getElementById('searchInput');
    const repoSelector = document.getElementById('repoSelector');
    const timeFilter = document.getElementById('timeFilter');
    const sortFilter = document.getElementById('sortFilter');
    const tableBody = document.getElementById('tableBody');
    const resetBtn = document.getElementById('resetFilters');

    async function loadData(type) {
        rawData = [];
        const fetchCSV = (url, strategy) => new Promise(res => Papa.parse(url, {
            download: true, header: true, skipEmptyLines: true,
            complete: (results) => res(results.data.filter(r => r.branch_name && r.time).map(r => ({...r, strategy})))
        }));

        if (type === 'all') {
            const [m, s] = await Promise.all([fetchCSV(URLS['main'], 'Multi'), fetchCSV(URLS['single-thread'], 'Single')]);
            rawData = [...m, ...s];
        } else {
            rawData = await fetchCSV(URLS[type], type === 'main' ? 'Multi' : 'Single');
        }
        applyFilters();
    }

    function applyFilters() {
        let filtered = [...rawData];
        const term = searchInput.value.toLowerCase();
        if (term) filtered = filtered.filter(r => r.branch_name.toLowerCase().includes(term));
        if (timeFilter.value !== 'all') filtered = filtered.filter(r => parseFloat(r.time) <= parseFloat(timeFilter.value));

        if (sortFilter.value === 'fastest') filtered.sort((a, b) => parseFloat(a.time) - parseFloat(b.time));
        else filtered.sort((a, b) => parseInt(b.entry_date) - parseInt(a.entry_date));

        updateStats(filtered);
        renderTable(filtered);
    }

    function updateStats(data) {
        if (data.length === 0) {
            document.getElementById('stat-fastest').innerText = "--";
            document.getElementById('stat-avg').innerText = "--";
            document.getElementById('stat-total').innerText = "0";
            return;
        }
        const times = data.map(d => parseFloat(d.time));
        document.getElementById('stat-fastest').innerText = Math.min(...times).toFixed(4) + 's';
        document.getElementById('stat-avg').innerText = (times.reduce((a, b) => a + b, 0) / times.length).toFixed(4) + 's';
        document.getElementById('stat-total').innerText = data.length;
    }

    function renderTable(data) {
        tableBody.innerHTML = '';
        const isAllMode = repoSelector.value === 'all';
        data.forEach((row, index) => {
            const time = parseFloat(row.time);
            const globalIndex = rawData.sort((a, b) => parseFloat(a.time) - parseFloat(b.time)).findIndex(i => i.branch_name === row.branch_name && i.strategy === row.strategy);
            const rank = globalIndex + 1;
            const isTop3 = rank <= 3 && sortFilter.value === 'fastest';
            const username = row.branch_name.trim();

            const tr = document.createElement('tr');
            tr.className = `hover:bg-white/5 transition-all group row-animate ${isTop3 ? 'bg-blue-500/5 border-l-4 border-blue-500' : ''}`;
            tr.style.animationDelay = `${index * 0.02}s`;

            const rankDisplay = MEDALS[rank] ? `<span class="text-xl">${MEDALS[rank]}</span>` : `#${rank.toString().padStart(2, '0')}`;
            const strategyBadge = isAllMode ? `<span class="text-[9px] ${row.strategy === 'Multi' ? 'bg-purple-500/20 text-purple-400 border-purple-500/30' : 'bg-blue-500/20 text-blue-400 border-blue-500/30'} px-2 py-0.5 rounded border ml-2">${row.strategy.toUpperCase()}</span>` : '';
            const eliteBadge = isTop3 ? `<span class="hidden md:inline text-[9px] bg-white/10 px-2 py-0.5 rounded-full text-slate-400 ml-2 font-bold border border-white/5 uppercase">Top Performance</span>` : '';

            tr.innerHTML = `
                <td class="px-8 py-5 mono font-bold ${isTop3 ? 'text-blue-400' : 'text-slate-600'}">${rankDisplay}</td>
                <td class="px-8 py-5">
                    <div class="flex items-center">
                        <a href="https://github.com/${username}" target="_blank" class="text-white font-bold hover:text-blue-400 transition-all uppercase tracking-tight flex items-center gap-2">
                            ${username} <svg class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                        </a>
                        ${strategyBadge} ${eliteBadge}
                    </div>
                </td>
                <td class="px-8 py-5 text-right mono font-bold ${time < 5 ? 'text-green-400' : 'text-blue-400'}">
                    ${time.toFixed(4)}<span class="text-[10px] ml-1 opacity-50 uppercase text-white text-xs">s</span>
                </td>
                <td class="px-8 py-5 text-center text-slate-500 text-sm mono">${new Date(row.entry_date * 1000).toLocaleDateString('en-US', {
                month: 'short',
                day: '2-digit'
            })}</td>
            `;
            tableBody.appendChild(tr);
        });
    }

    resetBtn.addEventListener('click', () => {
        searchInput.value = '';
        timeFilter.value = 'all';
        sortFilter.value = 'fastest';
        repoSelector.value = 'all';
        loadData('all');
    });

    [searchInput, timeFilter, sortFilter].forEach(el => el.addEventListener('input', applyFilters));
    repoSelector.addEventListener('change', (e) => loadData(e.target.value));

    loadData('all');
</script>
</body>
</html>